<!doctype html>
	<head>
		<title>An RSS and Atom Reader, Bookmarklet App</title>
	</head>
	<body>
		<section id="sidebar">
			<nav id="feeds"></nav>
		</section>
		<section id="mainArea"></section>
	</body>
	<script>
		var Observable = function(){
			var observers = {};
			var self = {
				observe: function(key, observer){
					if(observers[key] === undefined) observers[key] = [];
					observers[key].push(observer);
				}
				, stopObserving: function(observer){
					for(var key in observers){
						var i = 0;
						var ubounds = observers[key].length;				
						for(i; i < ubounds; i++){
							if(observers[key][i] === observer){
								observers[key].splice(i, 1);
								if(observers[key].length === 0) delete observers[key];
								break;
							}
						}
					}
				}
				, changed: function(key, old, v){
					if(observers[key] === undefined) return;
					var i = 0;
					var ubounds = observers[key].length;
					for(i; i<ubounds; i++){
						observers[key][i](key, old, v, this);
					}
				}
				, release: function(){
					var key = null;
					for(key in observers){
						var observer = null;
						while(observer = observers[key].pop()){}			
					}
				}
			};
			return self;
		};
		
		var List = function(list){
			var innerList = list || [];
			var self = Observable();
			Object.defineProperty(self, 'length', {
				get: function(){ return innerList.length;}
				, enumerable: true
			});
			Object.defineProperty(self, 'all', {
				get: function(){ return innerList;}
				, enumerable: true
			});
			self.push = function(feed){
				innerList.push(feed);
				this.changed('push', null, feed);
			};
			self.remove = function(delegate){
				var i = 0;
				var ubounds = innerList.length;
				var deleted = [];
				for(i; i < ubounds; i++){
					if(delegate(innerList[i])){
						deleted = innerList.splice(i, 1);
						this.changed('remove', deleted[0], i);
						break;
					}
				}
				return deleted[0];
			};
			return self;
		};
		var View = function(container, controller){
			var self = {
				container: container
				, controller: controller
				, views: []
				, release: function release(){
					if(!this.container.parentNode) return;
					this.container.parentNode.removeChild(this.container);
					this.controller.release();
					var view = null;
					while(view = this.views.pop()) view.release();
				}
			};
			self.controller.setView(self);
			return self;
		};
		var Controller = function Controller(delegate, model){
			var self = {
				model: model
				, delegate: delegate
				, release: function release(){}
				, view: null
			};
			self.setView = function(v){
				this.view = v;
			};
			self.release = function(){
				if(model.release) model.release();
			}
			return self;
		};
		
		var FeedView = function(container, controller){
			var self = View(container, controller);
			function addLink(link){
				var a = document.createElement('a');				
				a.setAttribute('href', link.url);
				self.container.appendChild(a);
			}
			self.added = function(key, old, v, m){				
				addLink(v);
			};
			self.removed = function(key, old, v, m){
				var elem = this.container.querySelector('[href="' + v.url + '"]');
				this.container.parentNode.removeChild(elem);
			};
			controller.model.observe('push', self.added);
			controller.model.observe('remove', self.removed);
			return self;
		};
		var FeedController = function(delegate, model){
			var self = Controller(delegate, model);
			
			return self;
		};
		var model = List();
		var favoriteFeeds = function(){
			return model;
		};
		var addFeed = function(url){
			model.push({url: url});
		};
		var deleteFeed = function(url){
			return model.remove(function(feed){
				return feed.url === url;
			});
		};
		
		var feedView = FeedView(document.getElementById('feeds'), FeedController(null, model));
		addFeed('http://backend.deviantart.com/rss.xml?type=deviation&q=boost%3Apopular+in%3Adigitalart%2Fdrawings+frogs');
		addFeed('http://digg.com/rss/top.rss');
		addFeed('http://www.reddit.com/.rss');
		addFeed('https://news.ycombinator.com/rss');
		addFeed('http://readwrite.com/rss.xml');
		addFeed('http://www.theverge.com/rss/frontpage');
	</script>
</html>